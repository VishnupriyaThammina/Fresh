(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[62682,24321],{532465:(e,t,n)=>{function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:()=>o});const i=new class{constructor(){a(this,"onResumeListeners",[]),a(this,"onPauseListeners",[]),a(this,"inExp",!1),a(this,"windowInFocus",!0)}setExperiment(e=!1){this.inExp=e}onSessionResume(e){return this.onResumeListeners.push(e),this}onSessionPause(e){return this.onPauseListeners.push(e),this}removeResumeListener(e){this.onResumeListeners.filter((t=>t!==e))}removePauseListener(e){this.onPauseListeners=this.onPauseListeners.filter((t=>t!==e))}getAppState(){return this.windowInFocus?0:void 0}},r=e=>{if(e.isHidden){const{reason:t}=e;i.windowInFocus=!1,i.onPauseListeners.forEach((e=>e(t)))}else i.windowInFocus=!0,i.onResumeListeners.forEach((e=>e()))};setTimeout((()=>{window.addEventListener("beforeunload",(()=>r({isHidden:!0,reason:"beforeunload"}))),window.addEventListener("focus",(()=>r({isHidden:!1}))),window.addEventListener("blur",(()=>r({isHidden:!0,reason:"blur"}))),window.addEventListener("pageshow",(()=>r({isHidden:!1}))),window.addEventListener("pagehide",(()=>r({isHidden:!0,reason:"pagehide"}))),void 0!==document.hidden?document.addEventListener("visibilitychange",(()=>r(document.hidden?{isHidden:!0,reason:"visibilitychange"}:{isHidden:!1})),!1):void 0!==document.webkitHidden&&document.addEventListener("webkitvisibilitychange",(()=>r(document.webkitHidden?{isHidden:!0,reason:"visibilitychange"}:{isHidden:!1})),!1)}),0);const o=i},77494:(e,t,n)=>{n.d(t,{Z:()=>W});var a=n(667294),i=n(532465),r=n(245410),o=n(93501),s=n(30482),c=n(763795),d=n(39983),p=n(677263),l=n(41162),m=n(372453),u=n(363959),g=n(324e3),T=n(583077);const f=({constraintMap:e,initialNavTiming:t,annotations:n})=>({...n,...(0,T.jh)("constraint_",e),...(0,T.jh)("mark_",(0,d.gQ)()),...(0,T.jh)("browser_",{...t?(0,T.D3)(t):{},...(0,T.rX)()})});var y=n(577491),h=n(335741),w=n(769916);const v=(e,t)=>{const{firstInputDelay:n}=(0,h.v2)();return[...e.map((e=>(0,y.Z)(e,t))).filter(Boolean),...n?[{name:"fid",id:(0,w.Z)(),parentId:t,startTime:n.startTime,endTime:n.endTime,annotationMap:{},binaryAnnotationMap:{}}]:[]]};var A=n(40660),_=n(813107);const S=({eventPrefix:e,endTime:t,tags:n,resourceArr:a,resourceType:i="allResources"})=>{const r=a.length;if(r>0&&"object"==typeof a[0]&&!Array.isArray(a[0])){const o=[...a].sort(((e,t)=>e.fetchStart-t.fetchStart)),s=[...a].sort(((e,t)=>e.responseEnd-t.responseEnd));let c=1;const d=t/5;let p=0;for(;c<=5;){let t=0;for(;p<=r-1&&o[p].fetchStart<=d*c;)p+=1,t+=1;A.Z.gauge(`${e}.tags.${i}.fetchStartInterval${c}of5`,t,.2,n),A.Z.gauge(`${e}.${i}.fetchStartInterval${c}of5`,t,.2),c+=1}const l={zeroPercentInFlight:o[0].fetchStart,twentyFivePercentInFlight:o[Math.floor(r/4)].fetchStart,fiftyPercentInFlight:o[2*Math.floor(r/4)].fetchStart,seventyFivePercentInFlight:o[3*Math.floor(r/4)].fetchStart,hundredPercentInFlight:o[r-1].fetchStart,twentyFivePercentComplete:s[Math.floor(r/4)].responseEnd,fiftyPercentComplete:s[2*Math.floor(r/4)].responseEnd,seventyFivePercentComplete:s[3*Math.floor(r/4)].responseEnd,hundredPercentComplete:s[r-1].responseEnd};for(const t in l)l[t]&&(A.Z.timing(`${e}.tags.${i}.${t}`,l[t],.2,n),A.Z.timing(`${e}.${i}.${t}`,l[t],.2))}},E=({annotateExperiments:e,endTime:t,entries:n,metricId:a,pwtStaticContext:i})=>{const r=`${(0,_.Z)(i)}.${a.surface}`,o=[r];e&&e.forEach((e=>{const t=i.getExperimentGroup(e)||"null";o.push(`${r}.${e}.${t}`)}));const s={lcpTimingBucket:(e=>{let t;return t=e<=2500?"Good":e>2500&&e<=4e3?"Needs Improvement":"Poor",t})((0,h.Bn)())||"unknown",isAuthenticated:i.isAuthenticated,navigationType:a.navigationType},c=Array.from(n.filter((e=>"number"==typeof e.encodedBodySize&&e.encodedBodySize>=1e4&&e.responseEnd<=t))),d=[],p=[],l=[],m=[],u=[];c.forEach((e=>{"img"===e.initiatorType?d.push(e):"css"===e.initiatorType?p.push(e):"script"===e.initiatorType?l.push(e):"xmlhttprequest"===e.initiatorType?m.push(e):"link"===e.initiatorType&&e.name.includes("i.pinimg.com")&&u.push(e)})),o.forEach((e=>{S({eventPrefix:e,endTime:t,tags:s,resourceArr:c}),S({eventPrefix:e,endTime:t,tags:s,resourceArr:d,resourceType:"image"}),S({eventPrefix:e,endTime:t,tags:s,resourceArr:p,resourceType:"css"}),S({eventPrefix:e,endTime:t,tags:s,resourceArr:l,resourceType:"scripts"}),S({eventPrefix:e,endTime:t,tags:s,resourceArr:m,resourceType:"xhr"}),S({eventPrefix:e,endTime:t,tags:s,resourceArr:u,resourceType:"preloadedImage"})}))};var I=n(353335);const C=({annotateExperiments:e,annotations:t,binaryAnnotations:n,constraintMap:a,endTime:i,imageTimings:r,metricId:o,pwtStaticContext:s,startTime:c,traceId:d,spans:p})=>{const l=(0,I.Cg)();let T;"initial_app_load"===o.navigationType&&(T=(0,u.Z)());const y=r.map((({name:e})=>e)),h=l.map((e=>(0,g.p)(e,y))).filter((({timing:e})=>!(({startTime:e,responseEnd:t},n)=>e>n.endTime||!!t&&t<n.startTime||e<n.startTime-100)(e,{startTime:c,endTime:i})));return"board"!==o.surface&&"pin_closeup"!==o.surface||E({annotateExperiments:e,endTime:i,entries:l,metricId:o,pwtStaticContext:s}),{type:"COMPLETE",traceId:d,startTime:c,endTime:i,spans:v(h,d).concat(p),annotationMap:f({constraintMap:a,initialNavTiming:T,annotations:t}),binaryAnnotationMap:(0,m.rA)({annotateExperiments:e,binaryAnnotations:n,entries:l,metricId:o,performanceResources:h,pwtEndTime:i,pwtStaticContext:s})}};let M=!1;const b=(e,t)=>e&&t?M?((0,c.H)("duplicated_initial_app_load_surface_pwt"),(0,w.Z)()):(M=!0,t):(0,w.Z)();var N=n(591614),P=n(361905);const R=e=>{const t=performance.getEntriesByType("resource").filter((e=>e.name.includes("i.pinimg"))).reduce(((e,t)=>{const n=t.name.replace(".jpg","").split("/");return{[n[n.length-1]]:{downloadSize:t.name.split("/")[3].split("x")[0]},...e}}),{});[...Array.from(document.getElementsByTagName("img")).map((e=>{const n=e.src.replace(".jpg","").split("/"),a=n[n.length-1];if(t[a]){var i;const n=(null===(i=(0,P.rZ)(e))||void 0===i?void 0:i.width)||1,r=t[a].downloadSize;return{fileName:a,renderedSize:n,downloadedSize:r,ratio:r/n}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}})),...Array.from(document.querySelectorAll('div[role="img"]')).map((e=>{const n=e.style.backgroundImage.split('"')[1].replace(".jpg","").split("/"),a=n[n.length-1];if(t[a]&&e instanceof HTMLDivElement){var i;const n=(null===(i=(0,P.rZ)(e))||void 0===i?void 0:i.width)||1,r=t[a].downloadSize;return{fileName:a,renderedSize:n,downloadedSize:r,ratio:r/n}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}}))].forEach((t=>{const{ratio:n,fileName:a,downloadedSize:i}=t;t.ratio>1.05&&(0,c.A9)(`checkImageRatio.${e}`,{count:Math.round(10*n)/10,tags:{fileName:`${i}_${a}`}})}))};var L=n(622200),x=n(282802);const O=(e,t)=>{const n=(0,a.useRef)(t);return{getState:()=>n.current,dispatch:t=>{n.current=e(n.current,t)}}};var $=n(694952),Z=n(935340),H=n(785893);const B=["initial_app_load","client_route_push"],z=(0,s.XV)("PwtSurface"),D="NavigationComplete",k="VisuallyComplete",U=(e,t)=>{e.isSampled&&(0,N.Z)({metricId:e.metricConfig.metricId,pwtStaticContext:e.metricConfig.pwtStaticContext,result:{type:"ABORT",reason:t}})},G=e=>{if(e.metricConfig.constraints.every((t=>e.constraintMap[t]))){const t=Math.max(...e.metricConfig.constraints.map((t=>e.constraintMap[t])));return((e,t)=>{var n;const{metricConfig:{metricId:a,pwtStaticContext:i,annotateExperiments:r},annotations:s,binaryAnnotations:p,constraintMap:l,startTime:m,imageTimings:u,isSampled:g,spans:T}=e;(0,d.L8)(`PWT_Complete_${(0,o.KJ)(a)}`);const f=b("initial_app_load"===a.navigationType,null===(n=i.serverData)||void 0===n?void 0:n.trace_id),y=C({annotateExperiments:r,annotations:s,binaryAnnotations:p,constraintMap:l,endTime:t,imageTimings:u,metricId:a,pwtStaticContext:i,startTime:m,traceId:f,spans:T});g&&(0,N.Z)({metricId:a,pwtStaticContext:i,result:y});try{R(String(y.binaryAnnotationMap["metricId.surface"].value))}catch(h){(0,c.H)("image_ratio_check_error",{error:h})}return{...e,result:y,status:"DONE"}})(e,t)}return e},F=(e,t)=>{const{constraint:n,time:a}=t,i=(0,o.KJ)(e.metricConfig.metricId);return L.Z?e.metricConfig.constraints.find((e=>e===n))?e.constraintMap[n]?(z(`constraint "${n}" is already complete.`),(0,c.H)("duplicated_constraint_complete",{constraint:n,action:i}),e):(z(`marking constraint "${n}" as complete`),(0,d.ZP)(`constraint_${n}_is_complete`),G({...e,constraintMap:{...e.constraintMap,[n]:a||L.Z.now()}})):(z(`marked constraint "${n}" is not a required constraint.`),e):((0,c.H)("missing_window_performance",{action:i}),e)},K=(e,t)=>{if(z("dispatch action",t),"INIT_ROUTE"===t.type)return((e,t)=>{const{metricConfig:n,startTime:a,isSampled:i}=t;if("TIMING"===e.status&&a!==e.startTime&&U(e,"routeUpdatedOnSameSurface"),!n)return{status:"DISABLED",metricConfig:null};const r=(0,o.KJ)(n.metricId);return"TIMING"===e.status&&e.startTime===a&&e.constraintMap[D]?((0,c.H)("duplicated_init_route_action",{action:r}),e):("Other"===n.pwtStaticContext.browserName&&!1===n.metricId.isAuthenticated&&"initial_app_load"===n.metricId.navigationType?((0,c.A9)(`TIMING.${r}`,{tags:{userAgent:null===(s=window)||void 0===s||null===(d=s.navigator)||void 0===d?void 0:d.userAgent}}),(0,c.A9)(`TIMING.sampled.${r}`,{tags:{userAgent:null===(p=window)||void 0===p||null===(l=p.navigator)||void 0===l?void 0:l.userAgent},sampleRate:.5})):((0,c.A9)(`TIMING.${r}`),(0,c.A9)(`TIMING.sampled.${r}`,{sampleRate:.5})),F({status:"TIMING",metricConfig:n,startTime:a,constraintMap:{},annotations:{},binaryAnnotations:{},imageTimings:[],isSampled:i,spans:[]},{constraint:D}));var s,d,p,l})(e,t.payload);if("TIMING"!==e.status)return z(`ignoring action due to invalid state ${e.status}`,t),e;switch(t.type){case"ABORT":U(e,t.reason);const n={type:"ABORT",reason:t.reason};return{...e,status:"DONE",result:n};case"ANNOTATE":const{name:a}=t.payload;if(!L.Z)return e;const i=L.Z.now();return z(`adding annotation {${a}: ${i}}`),{...e,annotations:{...e.annotations,[a]:i}};case"BINARY_ANNOTATE":const{name:r,value:s,annotationType:d}=t.payload;return z(`adding binary annotation {${r}: ${s}}`),{...e,binaryAnnotations:{...e.binaryAnnotations,[r]:{value:s,type:d}}};case"MARK_CONSTRAINT_COMPLETE":return F(e,t.payload);case"REMOVE_CONSTRAINT":return((e,t)=>{if(!L.Z){const t=(0,o.KJ)(e.metricConfig.metricId);(0,c.H)("missing_window_performance",{action:t})}z(`removing constraint "${t}"`);const n=e.metricConfig.constraints.filter((e=>e!==t)),{[t]:a,...i}=e.constraintMap;return G({...e,constraintMap:i,metricConfig:{...e.metricConfig,constraints:n}})})(e,t.payload);case"SET_SEGMENT":return((e,t)=>{if(!L.Z){const t=(0,o.KJ)(e.metricConfig.metricId);(0,c.H)("missing_window_performance",{action:t})}z(`updating pwt segment to "${t}"`);const n={...e.metricConfig.metricId,segment:t};return{...e,metricConfig:{...e.metricConfig,metricId:n}}})(e,t.payload);case"SET_VISUALLY_COMPLETE_RESULT":{const{payload:{imageTimings:n}}=t;if(0===n.length){U(e,"visuallyComplete_noImages");const t={type:"ABORT",reason:"visuallyComplete_noImages"};return{...e,status:"DONE",result:t}}const a=Math.max(...n.map((e=>e.responseEnd||0)));return F({...e,imageTimings:n},{constraint:k,time:a})}case"ADD_SUBSPAN":const{startTime:p}=e,{payload:{name:l,startTime:m,endTime:u,annotations:g,binaryAnnotations:T,parentId:f}}=t;return{...e,spans:[...e.spans,{name:l,id:(0,w.Z)(),startTime:m||p,endTime:u,annotationMap:{...g},binaryAnnotationMap:{...T},parentId:f}]};case"START_SUBSPAN":return{...e,spans:[...e.spans,{name:t.payload.name,id:(0,w.Z)(),startTime:L.Z?L.Z.now():0,endTime:1/0,annotationMap:{...t.payload.annotations},binaryAnnotationMap:{...t.payload.binaryAnnotations},parentId:t.payload.parentId}]};case"STOP_SUBSPAN":const y=e.spans.findIndex((e=>e.name===t.payload.name));return y>-1?(e.spans[y].endTime=L.Z?L.Z.now():0,t.payload.annotations&&(e.spans[y].annotationMap={...e.spans[y].annotationMap,...t.payload.annotations}),t.payload.binaryAnnotations&&(e.spans[y].binaryAnnotationMap={...e.spans[y].binaryAnnotationMap,...t.payload.binaryAnnotations})):(0,c.H)("invalid_subspan_stop_name",{name:t.payload.name}),e;default:const h=(0,o.KJ)(e.metricConfig.metricId);return(0,c.H)("invalid_pwt_surface_action",{action:h}),e}},j=e=>{if(!e)return"initial_app_load";switch(e.action){case"PUSH":return"client_route_push";case"REPLACE":return"client_route_replace";default:return null}},V=({surface:e,constraints:t,segment:n,measureGridVisuallyComplete:o,annotateExperiments:s,customEnabledNavigationTypes:c,navigationInfo:{clientNavigation:d,navigationType:l},sampleRate:m})=>{const u=(0,a.useRef)("NOT_SET"),g=(0,p.N5)(),{getState:T,dispatch:f}=O(K,{status:"DISABLED",metricConfig:null}),y=(0,x.B)();if(u.current!==d&&(u.current=d,g)){const{isAuthenticated:a}=g,i=e&&l&&(c||B).includes(l)?{metricId:{type:"surface",surface:e,navigationType:l,isAuthenticated:a,segment:n},annotateExperiments:s,constraints:[D,...t||[],...o?[k]:[]],pwtStaticContext:g}:null;f({type:"INIT_ROUTE",payload:{metricConfig:i,startTime:d?d.time:0,isSampled:!m||Math.random()<m}})}const h=(0,r.F)(),w=T();if((0,a.useEffect)((()=>{const e=e=>{f({type:"ABORT",reason:e})};i.Z.onSessionPause(e);const t=window.innerHeight,n=window.innerWidth,a=()=>{var e,i,r;const o=Math.abs(window.innerHeight-t),s=Math.abs(window.innerWidth-n),c=window.innerHeight!==t,d=window.innerWidth!==n,p={handler:(0,$.H)(),deviceType:null!==(e=null==g?void 0:g.deviceType)&&void 0!==e?e:"unknown",isAuthenticated:null!==(i=null==g?void 0:g.isAuthenticated)&&void 0!==i?i:"unknown",platform:null!==(r=y.userAgent.platform)&&void 0!==r?r:"unknown"};(0,Z.nP)("webapp.PwtLogger.handleResize",{sampleRate:1,tags:{...p,heightChanged:c,widthChanged:d}}),c&&(0,Z.S0)("webapp.PwtLogger.resizeHeightDelta",o,{sampleRate:1,tags:p}),d&&(0,Z.S0)("webapp.PwtLogger.resizeWidthDelta",s,{sampleRate:1,tags:p}),window.removeEventListener("resize",a),"phone"===(null==g?void 0:g.deviceType)&&(!d&&c&&o<=150||!c&&!d)&&h.checkExperiment(y.isAuthenticated?"web_pwt_resize_abort_auth":"web_pwt_resize_abort_unauth").anyEnabled?(0,Z.nP)("webapp.PwtLogger.skipResizeAbort",{sampleRate:1,tags:{...p,heightChanged:c,widthChanged:d}}):f({type:"ABORT",reason:"windowResized"})};return window.addEventListener("resize",a),()=>{const t=T();z("handling unmount",t),"TIMING"===t.status&&U(t,"unmount"),i.Z.removePauseListener(e),window.removeEventListener("resize",a)}}),[]),"TIMING"!==w.status||!w.constraintMap[D])return{state:w,context:null};const{startTime:v,metricConfig:A}=w;return{state:w,context:{abort:e=>f({type:"ABORT",reason:e}),addAnnotation:e=>f({type:"ANNOTATE",payload:{name:e}}),addBinaryAnnotation:(e,t,n)=>f({type:"BINARY_ANNOTATE",payload:{name:e,value:t,annotationType:n}}),addSubspan:(e,t,n,a={},i={},r=null)=>f({type:"ADD_SUBSPAN",payload:{name:e,startTime:t,endTime:n,annotations:a,binaryAnnotations:i,parentId:r}}),getId:()=>v,getMetricId:()=>A.metricId,markConstraintComplete:e=>f({type:"MARK_CONSTRAINT_COMPLETE",payload:{constraint:e,time:L.Z?L.Z.now():0}}),removeConstraint:e=>f({type:"REMOVE_CONSTRAINT",payload:e}),setSegment:e=>f({type:"SET_SEGMENT",payload:e}),setVisuallyCompleteResult:A.constraints.includes(k)?e=>f({type:"SET_VISUALLY_COMPLETE_RESULT",payload:e}):null,startSubspan:(e,t={},n={},a=null)=>f({type:"START_SUBSPAN",payload:{name:e,annotations:t,binaryAnnotations:n,parentId:a}}),stopSubspan:(e,t={},n={},a=null)=>f({type:"STOP_SUBSPAN",payload:{name:e,annotations:t,binaryAnnotations:n,parentId:a}})}}},J=()=>{const e=(0,l.E)(),t=!!e;(0,a.useEffect)((()=>{if(t){const t=null==e?void 0:e.getMetricId(),n=t?(0,o.KJ)(t):null;(0,c.H)("nested_pwt_surface",{action:n})}}),[t])};function W({children:e,...t}){var n;const a=(0,p.fM)(),i=j(a),r=[...null!==(n=t.annotateExperiments)&&void 0!==n?n:[]],o={...t,annotateExperiments:r,navigationInfo:{navigationType:i,clientNavigation:a}},{context:s}=V(o);return J(),(0,H.jsx)(l.S,{value:s,children:e})}},768337:(e,t,n)=>{n.d(t,{Z:()=>a});const a=e=>{switch(e){case"BR":case"MX":case"AR":case"CL":case"CO":return"LatAm";case"US":return"US";case"CA":return"CA";case"GB":return"GB";case"FR":return"FR";case"DE":return"DE";default:return"OTHER"}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/62682-3ede84bfa7519324.mjs.map